{"version":3,"sources":["../../../src/datasource/query/query.controller.js"],"names":["QueryCtrl","datasourceURL","PRIVATE_PROPERTIES","uiSegmentSrv","Symbol","scope","nodeMap","nodeSegment","nodeSpinner","nodeFocus","counterName","counterSpinner","counterFocus","counters","NET_CRUNCH_QUERY_CONTROLLER_DI","DEFAULT_NODE_NAME","DEFAULT_COUNTER_DISPLAY_NAME","COUNTERS_SUBMENU_LENGTH","NetCrunchQueryController","$scope","$rootScope","$timeout","$on","variableChanged","Map","createDefaultNodeSegment","localVars","Object","create","processingNode","nodeReady","datasource","nodes","then","updateView","target","nodeID","nodeChanged","processingCounter","counterReady","showOptions","alias","series","min","avg","max","segmentName","segment","cssClass","fake","type","html","value","newSegment","node","nodeSegmentTemplate","iconUrl","name","address","nodeDisplayValue","variableName","expandable","refresh","state","$apply","createVariableSegments","self","getNodeVariables","sort","variable1","variable2","toLocaleString","map","createVariableSegment","variable","createNodeSegments","clear","createNodeSegment","set","concat","all","nodeId","setCounterMenu","counterMenu","hideCounters","updateSelectedCounter","counterDataComplete","targetChanged","getCounters","countersByMonitors","countersMenu","keys","forEach","monitorId","subMenu","text","counter","displayName","subMenuPartsCount","Math","ceil","length","i","startIndex","stopIndex","subMenuNameExtension","subMenuName","push","submenu","slice","countersTable","table","some","isNodeTemplate","nodeNotReady","setNodeSegment","assign","Promise","resolve","find","nodeItem","id","has","get","selectedNodeId","nodeSegmentReady","updateCounterList","$inject"],"mappings":"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","file":"query.controller.js","sourcesContent":["/**\r\n * @license\r\n * Copyright AdRem Software. All Rights Reserved.\r\n *\r\n * Use of this source code is governed by an Apache License, Version 2.0 that can be\r\n * found in the LICENSE file.\r\n */\r\n\r\nimport '../css/query.editor.css!';            // eslint-disable-line\r\nimport '../directives/ncSpinner.directive';\r\nimport '../directives/ncFocus.directive';\r\nimport { QueryCtrl } from 'app/plugins/sdk';  // eslint-disable-line\r\nimport { datasourceURL } from '../common';\r\n\r\nconst\r\n  PRIVATE_PROPERTIES = {\r\n    uiSegmentSrv: Symbol('uiSegmentSrv'),\r\n    scope: Symbol('scope'),\r\n    nodeMap: Symbol('nodeMap'),\r\n    nodeSegment: Symbol('nodeSegment'),\r\n    nodeSpinner: Symbol('nodeSpinner'),\r\n    nodeFocus: Symbol('nodeFocus'),\r\n    counterName: Symbol('counterName'),\r\n    counterSpinner: Symbol('counterSpinner'),\r\n    counterFocus: Symbol('counterFocus'),\r\n    counters: Symbol('counters')\r\n  },\r\n  NET_CRUNCH_QUERY_CONTROLLER_DI = ['uiSegmentSrv', '$scope', '$rootScope', '$timeout'],\r\n  DEFAULT_NODE_NAME = 'Select node',\r\n  DEFAULT_COUNTER_DISPLAY_NAME = 'Select counter',\r\n  COUNTERS_SUBMENU_LENGTH = 25;\r\n\r\nclass NetCrunchQueryController extends QueryCtrl {\r\n\r\n  constructor(uiSegmentSrv, $scope, $rootScope, $timeout) {\r\n    super();\r\n\r\n    this[PRIVATE_PROPERTIES.uiSegmentSrv] = uiSegmentSrv;\r\n    this[PRIVATE_PROPERTIES.scope] = $scope;\r\n    this[PRIVATE_PROPERTIES.nodeMap] = new Map();\r\n    this[PRIVATE_PROPERTIES.nodeSegment] = this.createDefaultNodeSegment(DEFAULT_NODE_NAME);\r\n    this[PRIVATE_PROPERTIES.nodeSpinner] = false;\r\n    this[PRIVATE_PROPERTIES.nodeFocus] = false;\r\n    this[PRIVATE_PROPERTIES.counterName] = null;\r\n    this[PRIVATE_PROPERTIES.counterSpinner] = false;\r\n    this[PRIVATE_PROPERTIES.counterFocus] = false;\r\n    this[PRIVATE_PROPERTIES.counters] = [];\r\n\r\n    this.localVars = Object.create(null);\r\n\r\n    this.processingNode = true;\r\n    this.nodeReady = false;\r\n    this.datasource.nodes().then(() => {\r\n      this.processingNode = false;\r\n      this.updateView();\r\n      if (this.target.nodeID != null) {\r\n        this.nodeChanged(this.target.nodeID);\r\n      } else {\r\n        this.nodeFocus = true;\r\n      }\r\n    });\r\n\r\n    this.processingCounter = true;\r\n    this.counterReady = false;\r\n\r\n    this.showOptions = (this.showOptions == null) ? false : this.showOptions;\r\n\r\n    this.target.alias = this.target.alias || '';\r\n    this.target.series = this.target.series || { min: false, avg: true, max: false };\r\n\r\n    $rootScope.$on('template-variable-value-updated', () => $timeout(() => this.variableChanged(), 0));\r\n  }\r\n\r\n  get localVars() {\r\n    return this.target.localVars;\r\n  }\r\n\r\n  set localVars(value) {\r\n    this.target.localVars = value;\r\n  }\r\n\r\n  get processingNode() {\r\n    return this.localVars.processingNode;\r\n  }\r\n\r\n  set processingNode(value) {\r\n    this.localVars.processingNode = value;\r\n  }\r\n\r\n  get nodeSpinner() {\r\n    return this[PRIVATE_PROPERTIES.nodeSpinner];\r\n  }\r\n\r\n  get nodeSegment() {\r\n    return this[PRIVATE_PROPERTIES.nodeSegment];\r\n  }\r\n\r\n  get nodeFocus() {\r\n    return this[PRIVATE_PROPERTIES.nodeFocus];\r\n  }\r\n\r\n  set nodeFocus(value) {\r\n    this[PRIVATE_PROPERTIES.nodeFocus] = value;\r\n  }\r\n\r\n  get nodeReady() {\r\n    return this.localVars.nodeReady;\r\n  }\r\n\r\n  set nodeReady(value) {\r\n    this.localVars.nodeReady = value;\r\n  }\r\n\r\n  get processingCounter() {\r\n    return this.localVars.processingCounter;\r\n  }\r\n\r\n  set processingCounter(value) {\r\n    this.localVars.processingCounter = value;\r\n  }\r\n\r\n  get defaultCounterName() {              // eslint-disable-line\r\n    return DEFAULT_COUNTER_DISPLAY_NAME;\r\n  }\r\n\r\n  get counterSpinner() {\r\n    return this[PRIVATE_PROPERTIES.counterSpinner];\r\n  }\r\n\r\n  get counterFocus() {\r\n    return this[PRIVATE_PROPERTIES.counterFocus];\r\n  }\r\n\r\n  set counterFocus(value) {\r\n    this[PRIVATE_PROPERTIES.counterFocus] = value;\r\n  }\r\n\r\n  get counterReady() {\r\n    return this.localVars.counterReady;\r\n  }\r\n\r\n  set counterReady(value) {\r\n    this.localVars.counterReady = value;\r\n  }\r\n\r\n  get counterName() {\r\n    return this[PRIVATE_PROPERTIES.counterName];\r\n  }\r\n\r\n  get counters() {\r\n    return this[PRIVATE_PROPERTIES.counters];\r\n  }\r\n\r\n  get counterDataComplete() {\r\n    return this.target.counterDataComplete;\r\n  }\r\n\r\n  set counterDataComplete(value) {\r\n    this.target.counterDataComplete = value;\r\n  }\r\n\r\n  get alias() {\r\n    return this.target.alias;\r\n  }\r\n\r\n  set alias(value) {\r\n    this.target.alias = value;\r\n  }\r\n\r\n  get series() {\r\n    return this.target.series;\r\n  }\r\n\r\n  get showOptions() {\r\n    return this.localVars.showOptions;\r\n  }\r\n\r\n  set showOptions(value) {\r\n    this.localVars.showOptions = value;\r\n  }\r\n\r\n  createDefaultNodeSegment(segmentName) {\r\n    const segment = {\r\n      cssClass: 'nc-reset-segment',\r\n      fake: true,\r\n      type: 'value',\r\n      html: `<div class=\"nc-default-tile\">${segmentName}</div>`,\r\n      value: segmentName\r\n    };\r\n    return this[PRIVATE_PROPERTIES.uiSegmentSrv].newSegment(segment);\r\n  }\r\n\r\n  createNodeSegment(node) {\r\n\r\n    const nodeSegmentTemplate = `\r\n      <div class=\"nc-node-tile\">\r\n        <img class=\"nc-node-icon\" src=${node.iconUrl}>\r\n        <div class=\"nc-node-description\">\r\n          <span class=\"nc-node-name\">${node.name}</span>\r\n          <span class=\"nc-node-address\">${node.address}</span>\r\n        </div>\r\n      </div>\r\n    `;\r\n\r\n    return this[PRIVATE_PROPERTIES.uiSegmentSrv].newSegment({\r\n      cssClass: 'nc-reset-segment',\r\n      fake: true,\r\n      type: 'value',\r\n      html: nodeSegmentTemplate,\r\n      value: NetCrunchQueryController.nodeDisplayValue(node)\r\n    });\r\n  }\r\n\r\n  createVariableSegment(variableName) {\r\n    return this[PRIVATE_PROPERTIES.uiSegmentSrv].newSegment({\r\n      cssClass: 'nc-reset-segment',\r\n      expandable: true,\r\n      fake: true,\r\n      type: 'template',\r\n      html: `<div class=\"nc-default-tile\">$${variableName}</div>`,\r\n      value: `$${variableName}`\r\n    });\r\n  }\r\n\r\n  targetChanged() {\r\n    this.refresh();\r\n  }\r\n\r\n  nodeSpinnerChanged(state) {\r\n    this[PRIVATE_PROPERTIES.nodeSpinner] = state;\r\n  }\r\n\r\n  counterSpinnerChanged(state) {\r\n    this[PRIVATE_PROPERTIES.counterSpinner] = state;\r\n  }\r\n\r\n  updateView() {\r\n    this[PRIVATE_PROPERTIES.scope].$apply();\r\n  }\r\n\r\n  getNodes() {\r\n    const self = this;\r\n\r\n    function createVariableSegments() {\r\n      return self.datasource.getNodeVariables()\r\n        .sort((variable1, variable2) => variable1.name.toLocaleString(variable2.name))\r\n        .map(variable => self.createVariableSegment(variable.name));\r\n    }\r\n\r\n    function createNodeSegments(nodes) {\r\n      self[PRIVATE_PROPERTIES.nodeMap].clear();\r\n      return nodes.map((node) => {\r\n        const nodeSegment = self.createNodeSegment(node);\r\n        self[PRIVATE_PROPERTIES.nodeMap].set(nodeSegment.value, node);\r\n        return nodeSegment;\r\n      });\r\n    }\r\n\r\n    return this.datasource\r\n      .nodes().then(nodes => []\r\n        .concat(createVariableSegments())\r\n        .concat(createNodeSegments(nodes.all)));\r\n  }\r\n\r\n  updateCounterList(nodeId = this.target.nodeID) {\r\n    const self = this;\r\n\r\n    function setCounterMenu(counterMenu) {\r\n      self.hideCounters = true;\r\n      self.updateView();\r\n      self[PRIVATE_PROPERTIES.counters] = counterMenu;\r\n      self.processingCounter = false;\r\n      self.hideCounters = false;\r\n    }\r\n\r\n    function updateSelectedCounter(counterName) {\r\n      self[PRIVATE_PROPERTIES.counterName] = counterName;\r\n      self.counterReady = true;\r\n      self.counterDataComplete = true;\r\n      self.targetChanged();\r\n    }\r\n\r\n    function getCounters(nodeId) {               // eslint-disable-line\r\n      return self.datasource.getCounters(nodeId)\r\n        .then((countersByMonitors) => {\r\n          const countersMenu = [];\r\n\r\n          Object.keys(countersByMonitors).forEach((monitorId) => {\r\n            if (monitorId > 0) {\r\n              const\r\n                subMenu = countersByMonitors[monitorId]\r\n                  .counters.map(counter => ({\r\n                    text: counter.displayName,\r\n                    value: counter.name\r\n                  })),\r\n                subMenuPartsCount = Math.ceil(subMenu.length / COUNTERS_SUBMENU_LENGTH);\r\n\r\n              for (let i = 0; i < subMenuPartsCount; i += 1) {\r\n                const\r\n                  startIndex = i * COUNTERS_SUBMENU_LENGTH,\r\n                  stopIndex = Math.min((i + 1) * COUNTERS_SUBMENU_LENGTH, subMenu.length),\r\n                  subMenuNameExtension = (subMenuPartsCount > 1) ? ` [${startIndex + 1}..${stopIndex}]` : '',\r\n                  subMenuName = `${countersByMonitors[monitorId].name}${subMenuNameExtension}`;\r\n\r\n                countersMenu.push({\r\n                  text: subMenuName,\r\n                  submenu: subMenu.slice(startIndex, stopIndex)\r\n                });\r\n              }\r\n            }\r\n          });\r\n\r\n          return {\r\n            countersMenu,\r\n            countersTable: countersByMonitors.table\r\n          };\r\n        });\r\n    }\r\n\r\n    this.processingCounter = true;\r\n    this.counterReady = false;\r\n    this.counterDataComplete = false;\r\n    this.updateView();\r\n\r\n    getCounters(nodeId)\r\n      .then((counters) => {\r\n        setCounterMenu(counters.countersMenu);\r\n        if (counters.countersTable.some(counter => (counter.name === this.target.counterName))) {\r\n          updateSelectedCounter(this.target.counterName);\r\n        } else {\r\n          this.targetChanged();\r\n          this.counterFocus = true;\r\n        }\r\n      });\r\n  }\r\n\r\n  nodeChanged(nodeId = null) {\r\n    const self = this;\r\n\r\n    function isNodeTemplate(nodeId) {            // eslint-disable-line\r\n      return self.datasource.isNodeTemplate(nodeId);\r\n    }\r\n\r\n    function nodeNotReady() {\r\n      self.nodeReady = false;\r\n      self.processingCounter = true;\r\n      self.counterReady = false;\r\n      self.counterDataComplete = false;\r\n    }\r\n\r\n    function setNodeSegment(nodeId) {            // eslint-disable-line\r\n\r\n      if (isNodeTemplate(nodeId)) {\r\n        Object.assign(self[PRIVATE_PROPERTIES.nodeSegment], self.createVariableSegment(nodeId.slice(1)));\r\n        self.updateView();\r\n        return Promise.resolve();\r\n      }\r\n\r\n      return self.datasource\r\n        .nodes().then((nodes) => {\r\n          const node = nodes.all.find(nodeItem => (nodeItem.id === nodeId));\r\n          Object.assign(self[PRIVATE_PROPERTIES.nodeSegment], self.createNodeSegment(node));\r\n          self.updateView();\r\n        });\r\n    }\r\n\r\n    function getSelectedNode(nodeId) {           // eslint-disable-line\r\n\r\n      if (nodeId != null) {\r\n        if (isNodeTemplate(nodeId)) {\r\n          return Promise.resolve(nodeId);\r\n        }\r\n        return self.datasource\r\n          .nodes()\r\n          .then(nodes => ((nodes.all.some(node => (nodeId === node.id))) ? nodeId : null));\r\n      } else if (isNodeTemplate(self.nodeSegment.value)) {\r\n        return Promise.resolve(self.nodeSegment.value);\r\n      } else if (self[PRIVATE_PROPERTIES.nodeMap].has(self.nodeSegment.value)) {\r\n        return Promise.resolve(self[PRIVATE_PROPERTIES.nodeMap].get(self.nodeSegment.value).id);\r\n      }\r\n\r\n      return Promise.resolve(null);\r\n    }\r\n\r\n    getSelectedNode(nodeId).then((selectedNodeId) => {\r\n      this.target.nodeID = selectedNodeId;\r\n\r\n      if (selectedNodeId == null) {\r\n        nodeNotReady();\r\n        Object.assign(this[PRIVATE_PROPERTIES.nodeSegment], this.createDefaultNodeSegment(DEFAULT_NODE_NAME));\r\n        this.targetChanged();\r\n      } else {\r\n        const nodeSegmentReady = (nodeId != null) ? setNodeSegment(nodeId) : Promise.resolve();\r\n\r\n        this.nodeReady = true;\r\n        this.processingCounter = true;\r\n        this.counterReady = false;\r\n        this.updateView();\r\n\r\n        nodeSegmentReady\r\n          .then(() => self.updateCounterList(selectedNodeId));\r\n      }\r\n    });\r\n  }\r\n\r\n  counterChanged(counter) {\r\n    this[PRIVATE_PROPERTIES.counterName] = counter.value;\r\n    this.target.counterName = counter.value;\r\n    this.counterDataComplete = true;\r\n    this.targetChanged();\r\n  }\r\n\r\n  toggleShowOptions() {\r\n    this.showOptions = !this.showOptions;\r\n  }\r\n\r\n  variableChanged() {\r\n    this.updateCounterList();\r\n  }\r\n\r\n  static nodeDisplayValue(node) {\r\n    if ((node.name != null) && (node.name !== '')) {\r\n      return `${node.name}${(((node.address != null) && (node.address !== '')) ? ` (${node.address})` : '')}`;\r\n    } else if ((node.address != null) && (node.address !== '')) {\r\n      return node.address;\r\n    }\r\n    return '';\r\n  }\r\n\r\n  static get templateUrl() {\r\n    return `${datasourceURL}query/query.editor.html`;\r\n  }\r\n\r\n  static set templateUrl(value) {   // eslint-disable-line\r\n  }\r\n\r\n}\r\n\r\nNetCrunchQueryController.$inject = NET_CRUNCH_QUERY_CONTROLLER_DI;\r\n\r\nexport {\r\n  NetCrunchQueryController\r\n};\r\n"]}