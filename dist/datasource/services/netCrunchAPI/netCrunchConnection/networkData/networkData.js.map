{"version":3,"sources":["../../../../../../src/datasource/services/netCrunchAPI/netCrunchConnection/networkData/networkData.js"],"names":["NetCrunchNetworkData","adremClient","netCrunchServerConnection","openRemoteData","table","query","processFunction","notifyFunction","dataList","RemoteDataListStore","self","Promise","resolve","on","data","length","forEach","open","processHostsData","nodeRec","networkAtlas","addNode","processMapData","mapRec","addMap","NetCrunchNetworkAtlas","nodesReady","networksReady","remoteDataInitialized","promise","nodes","networks","atlas","all","then","init","hostsData","networkData","onNodesChanged","onNetworksChanged"],"mappings":"kHAYA,QAASA,qBAAT,CAA8BC,CAA9B,CAA2CC,CAA3C,CAAsE,CAYpE,QAASC,EAAT,CAAwBC,CAAxB,CAA+BC,CAA/B,CAAsCC,CAAtC,CAAuDC,CAAvD,CAAuE,CACrE,GACEC,GAAW,GAAIP,GAAYQ,mBAAhB,CAAoC,OAApC,KAAmDP,CAAnD,CADb,CAEEQ,EAAO,IAFT,CAIA,MAAO,IAAIC,QAAJ,CAAY,SAACC,CAAD,CAAa,CACC,UAA3B,QAAON,EADmB,EAE5BE,EAASK,EAAT,CAAY,gBAAZ,CAA8B,SAACC,CAAD,CAAU,CAChB,IAAjB,IAASA,IAAV,EAAmD,CAAvB,GAASA,IAAT,CAAcC,MADR,EAEpCD,EAAKE,OAAL,CAAaV,CAAb,CAA8BI,CAA9B,CAEH,CAJD,CAF4B,CASA,UAA1B,QAAOH,EATmB,EAU5BC,EAASK,EAAT,CAAY,SAAZ,CAAuB,UAAM,CAC3BN,GACD,CAFD,CAV4B,CAe9BC,EAASS,IAAT,CAAcb,CAAd,CAAqBC,CAArB,CAA4B,UAAM,CAChCO,GACD,CAFD,CAGD,CAlBM,CAmBR,CAED,QAASM,EAAT,CAA0BC,CAA1B,CAAmC,CACjCC,EAAaC,OAAb,CAAqBF,CAArB,CACD,CAED,QAASG,EAAT,CAAwBC,CAAxB,CAAgC,CAC9BH,EAAaI,MAAb,CAAoBD,CAApB,CACD,CA1CD,GACEH,GAAe,GAAIK,sBAAJ,CAA0BvB,CAA1B,CADjB,CAEEwB,IAFF,CAGEC,IAHF,CAKIC,EAAwB,IAL5B,CA4CA,MArCAF,GAAWG,OAAX,CAAqB,GAAIlB,QAAJ,CAAY,kBAAYe,GAAWd,OAAX,CAAqBA,CAAjC,CAAZ,CAqCrB,CApCAe,EAAcE,OAAd,CAAwB,GAAIlB,QAAJ,CAAY,kBAAYgB,GAAcf,OAAd,CAAwBA,CAApC,CAAZ,CAoCxB,CAAO,CACLkB,MAAO,uBAAMJ,GAAWG,OAAjB,CADF,CAELE,SAAU,0BAAMJ,GAAcE,OAApB,CAFL,CAGLG,MAAO,uBAAMrB,SACVsB,GADU,CACN,CAACP,EAAWG,OAAZ,CAAqBF,EAAcE,OAAnC,CADM,EAEVK,IAFU,CAEL,iBAAMd,EAAN,CAFK,CAAN,CAHF,CAOLe,KAAM,eAAW,CACf,GAWEzB,GAAO,IAXT,CAcE0B,QAdF,CAeEC,QAfF,CADe,MAiCc,KAAzB,GAjCW,EAsCfD,EAAYjC,EAAe,OAAf,CAlCI,uDAkCJ,CAAqCe,CAArC,CApBZ,UAAwB,CACtBQ,EAAWd,OAAX,CAAmBQ,EAAaU,KAAhC,CADsB,CAEa,UAA/B,QAAOpB,GAAK4B,cAFM,EAGpB5B,EAAK4B,cAAL,EAEH,CAeW,CAtCG,CAyCfD,EAAclC,EAAe,UAAf,oSAA2CmB,CAA3C,CAhBd,UAA2B,CACzBK,EAAcf,OAAd,CAAsBQ,EAAaY,KAAnC,CADyB,CAGa,UAAlC,QAAOtB,GAAK6B,iBAHS,EAIvB7B,EAAK6B,iBAAL,EAEH,CAUa,CAzCC,CA2CfX,EAAwBjB,QAAQsB,GAAR,CAAY,CAACG,CAAD,CAAYC,CAAZ,CAAZ,CA3CT,CA6CRT,CA7CQ,EAkCNA,CAYV,CArDI,CAwDR,CAlHD;;;;;;GAQA,kE,wCAESH,qB,eAAAA,qB,qDA2GPzB,oB","file":"networkData.js","sourcesContent":["/**\n * @license\n * Copyright AdRem Software. All Rights Reserved.\n *\n * Use of this source code is governed by an Apache License, Version 2.0 that can be\n * found in the LICENSE file.\n */\n\n/* eslint-disable func-names, object-shorthand, prefer-template */\n\nimport { NetCrunchNetworkAtlas } from './networkAtlas';\n\nfunction NetCrunchNetworkData(adremClient, netCrunchServerConnection) {\n\n  const\n    networkAtlas = new NetCrunchNetworkAtlas(netCrunchServerConnection),\n    nodesReady = {},\n    networksReady = {};\n\n  let remoteDataInitialized = null;\n\n  nodesReady.promise = new Promise(resolve => (nodesReady.resolve = resolve));\n  networksReady.promise = new Promise(resolve => (networksReady.resolve = resolve));\n\n  function openRemoteData(table, query, processFunction, notifyFunction) {\n    const\n      dataList = new adremClient.RemoteDataListStore('ncSrv', 1000, netCrunchServerConnection),\n      self = this;\n\n    return new Promise((resolve) => {\n      if (typeof processFunction === 'function') {\n        dataList.on('record-changed', (data) => {\n          if ((dataList.data != null) && (dataList.data.length > 0)) {\n            data.forEach(processFunction, self);\n          }\n        });\n      }\n\n      if (typeof notifyFunction === 'function') {\n        dataList.on('changed', () => {\n          notifyFunction();\n        });\n      }\n\n      dataList.open(table, query, () => {\n        resolve();\n      });\n    });\n  }\n\n  function processHostsData(nodeRec) {\n    networkAtlas.addNode(nodeRec);\n  }\n\n  function processMapData(mapRec) {\n    networkAtlas.addMap(mapRec);\n  }\n\n  return {\n    nodes: () => nodesReady.promise,\n    networks: () => networksReady.promise,\n    atlas: () => Promise\n      .all([nodesReady.promise, networksReady.promise])\n      .then(() => networkAtlas),\n\n    init: function() {\n      const\n        PERFORMANCE_VIEWS_NET_INT_ID = 2,\n        MONITORING_PACKS_NET_INT_ID = 3,\n        HOSTS_QUERY = 'Select Id, Name, Address, DeviceType, GlobalDataNode ',\n        NETWORKS_QUERY = 'Select NetIntId, DisplayName, HostMapData, IconId, ' +\n                         'MapType, NetworkData, MapClassTag ' +\n                         'where (MapClassTag != \\'policynet\\') && (MapClassTag != \\'pnet\\') && ' +\n                         '(MapClassTag != \\'dependencynet\\') && ' +\n                         '(MapClassTag != \\'issuesnet\\') && (MapClassTag != \\'all\\') && ' +\n                         '(NetIntId != ' + PERFORMANCE_VIEWS_NET_INT_ID + ') && ' +\n                         '(NetIntId != ' + MONITORING_PACKS_NET_INT_ID + ')',\n        self = this;\n\n      let\n        hostsData,\n        networkData;\n\n      function hostsChanged() {\n        nodesReady.resolve(networkAtlas.nodes);\n        if (typeof self.onNodesChanged === 'function') {\n          self.onNodesChanged();\n        }\n      }\n\n      function networksChanged() {\n        networksReady.resolve(networkAtlas.atlas);\n\n        if (typeof self.onNetworksChanged === 'function') {\n          self.onNetworksChanged();\n        }\n      }\n\n      if (remoteDataInitialized != null) {\n        return remoteDataInitialized;\n      }\n\n      // eslint-disable-next-line\n      hostsData = openRemoteData('Hosts', HOSTS_QUERY, processHostsData, hostsChanged);\n\n      // eslint-disable-next-line\n      networkData = openRemoteData('Networks', NETWORKS_QUERY, processMapData, networksChanged);\n\n      remoteDataInitialized = Promise.all([hostsData, networkData]);\n\n      return remoteDataInitialized;\n    }\n\n  };\n}\n\nexport {\n  NetCrunchNetworkData\n};\n"]}