'use strict';System.register(['./queryParser'],function(_export,_context){'use strict';var QueryParser,_createClass,NetCrunchMetricFindQuery;function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}return Array.from(arr)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError('Cannot call a class as a function')}return{setters:[function(_queryParser){QueryParser=_queryParser.QueryParser}],execute:function(){_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,'value'in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();_export('NetCrunchMetricFindQuery',NetCrunchMetricFindQuery=function(){function NetCrunchMetricFindQuery(a,b){_classCallCheck(this,NetCrunchMetricFindQuery),this.datasource=a,this.query=b}return _createClass(NetCrunchMetricFindQuery,[{key:'process',value:function process(){var a=NetCrunchMetricFindQuery.parseQuery(this.query);return a.completeParsed?Promise.all([this.datasource.nodes(),this.datasource.atlas()]).then(function(b){var c=b[1],d=b[0].all,e=NetCrunchMetricFindQuery.processQuery(a.tokens,c,d);return NetCrunchMetricFindQuery.createQueryResult(e.success?e.nodes:[])}):Promise.resolve(NetCrunchMetricFindQuery.createQueryResult([]))}}],[{key:'parseQuery',value:function parseQuery(a){var b=QueryParser.parse(a),c={completeParsed:!1,unparsedQuery:'',tokens:[]};return null!=b&&(c.completeParsed=''===b.residuals,c.unparsedQuery=b.residuals,c.tokens=b.token.value),c}},{key:'processQuery',value:function processQuery(a,b,c){function d(m,n){return{success:m,nodes:n}}function e(m,n){var o=[],p=void 0;return 0===n.length?(o.push.apply(o,_toConsumableArray(m.allNodesId)),o.success=!0,o):(p=m.getChildMapByDisplayName(n.shift()),null!=p)?e(p,n):(o.success=!1,o)}function f(m,n){var o=new Map,p=[];return m.forEach(function(q){return o.set(q.id,q)}),n.forEach(function(q){o.has(q)&&p.push(o.get(q))}),p}function g(m,n,o){var p=e(n,[].concat(o)),q=[];return p.success&&(q=f(m,p)),d(p.success,q)}for(var h={nodes:function(n){return function(){return d(!0,n)}}(c),deviceType:function deviceType(n,o){return d(!0,o.filter(function(p){return p.checkDeviceType(n)}))},networkMap:function networkMap(n,o){return g(o,b.networkAtlasRoot,n)},monitoringPack:function monitoringPack(n,o){return n.shift(),g(o,b.monitoringPacks,n)}},i=void 0,j=!0,k=void 0,l=[];j&&0<a.length;)i=a.shift(),k=h[i.type](i.value,l),j=k.success,j&&(l=k.nodes);return{success:j,nodes:l}}},{key:'createQueryResult',value:function createQueryResult(a){return(a||[]).map(function(b){var c=null==b.address?'':'('+b.address+')';return{text:b.name+' '+c,value:b.id}})}}]),NetCrunchMetricFindQuery}());_export('NetCrunchMetricFindQuery',NetCrunchMetricFindQuery)}}});
//# sourceMappingURL=metricFindQuery.js.map
