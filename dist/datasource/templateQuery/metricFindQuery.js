'use strict';System.register(['./queryParser','./defaultEnglishMonitoringPacks'],function(_export,_context){'use strict';var QueryParser,NetCrunchDefaultEnglishMonitoringPacks,_createClass,NetCrunchMetricFindQuery;function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}return Array.from(arr)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError('Cannot call a class as a function')}return{setters:[function(_queryParser){QueryParser=_queryParser.QueryParser},function(_defaultEnglishMonitoringPacks){NetCrunchDefaultEnglishMonitoringPacks=_defaultEnglishMonitoringPacks.NetCrunchDefaultEnglishMonitoringPacks}],execute:function(){_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,'value'in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();_export('NetCrunchMetricFindQuery',NetCrunchMetricFindQuery=function(){function NetCrunchMetricFindQuery(a,b){_classCallCheck(this,NetCrunchMetricFindQuery),this.datasource=a,this.query=b}return _createClass(NetCrunchMetricFindQuery,[{key:'process',value:function process(){var a=NetCrunchMetricFindQuery.parseQuery(this.query);return a.completeParsed?Promise.all([this.datasource.nodes(),this.datasource.atlas()]).then(function(b){var c=b[1],d=b[0].all,e=NetCrunchMetricFindQuery.processQuery(a.tokens,c,d);return NetCrunchMetricFindQuery.createQueryResult(e.success?e.nodes:[])}):Promise.resolve(NetCrunchMetricFindQuery.createQueryResult([]))}}],[{key:'parseQuery',value:function parseQuery(a){var b=QueryParser.parse(a),c={completeParsed:!1,unparsedQuery:'',tokens:[]};return null!=b&&(c.completeParsed=''===b.residuals,c.unparsedQuery=b.residuals,c.tokens=b.token.value),c}},{key:'processQuery',value:function processQuery(a,b,c){function d(n,o){return{success:n,nodes:o}}function e(n,o){var p=[],q=void 0;if(null!=n){if(0===o.length)return p.push.apply(p,_toConsumableArray(n.allNodesId)),p.success=!0,p;// eslint-disable-line prefer-const
if(q=n.getChildMapByDisplayName(o.shift()),null!=q)return e(q,o)}return p.success=!1,p}function f(n,o){var p=new Map,q=[];return n.forEach(function(r){return p.set(r.id,r)}),o.forEach(function(r){p.has(r)&&q.push(p.get(r))}),q}function g(n,o,p){var q=e(o,[].concat(p)),r=[];return q.success&&(r=f(n,q)),d(q.success,r)}function h(n,o){var p=b.atlasMaps.has(o)?b.atlasMaps.get(o):null,q=null!=p,r=q?f(n,p.allNodesId):[];return d(q,r)}for(var i={nodes:function(o){return function(){return d(!0,o)}}(c),deviceType:function deviceType(o,p){return d(!0,p.filter(function(q){return q.checkDeviceType(o)}))},networkMap:function networkMap(o,p){return g(p,b.networkAtlasRoot,o)},monitoringPack:function monitoringPack(o,p){var q=o.shift()?o:[],r=g(p,b.monitoringPacks,q);if(!r.success){var s=NetCrunchDefaultEnglishMonitoringPacks.getMonitoringPackId(q);return null==s?d(!1,[]):h(p,s)}return r}},j=void 0,k=!0,l=void 0,m=[];k&&0<a.length;)j=a.shift(),l=i[j.type](j.value,m),k=l.success,k&&(m=l.nodes);return{success:k,nodes:m}}},{key:'createQueryResult',value:function createQueryResult(a){return(a||[]).map(function(b){var c=null==b.address?'':'('+b.address+')';return{text:b.name+' '+c,value:b.id}})}}]),NetCrunchMetricFindQuery}());_export('NetCrunchMetricFindQuery',NetCrunchMetricFindQuery)}}});
//# sourceMappingURL=metricFindQuery.js.map
