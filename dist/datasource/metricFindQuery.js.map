{"version":3,"sources":["../../src/datasource/metricFindQuery.js"],"names":["NetCrunchMetricFindQuery","datasource","query","selectors","createQueryResult","nodes","map","node","ipAddress","address","text","name","value","id","parameters","split","filter","then","result","all","length","operations","deviceTypeFilter","join","match","Promise","resolve"],"mappings":"ozBAQMA,wB,YAEJ,kCAAYC,CAAZ,CAAwBC,CAAxB,CAA+B,gDAC7B,KAAKD,UAAL,CAAkBA,CADW,CAE7B,KAAKC,KAAL,CAAaA,CACd,C,gFAEKC,C,CAAW,CAEf,QAASC,EAAT,CAA2BC,CAA3B,CAAkC,CAChC,MAAOA,GAAMC,GAAN,CAAU,SAACC,CAAD,CAAU,CACzB,GAAMC,GAA6B,IAAhB,IAAKC,OAAN,CAA+C,EAA/C,KAA6BF,EAAKE,OAAlC,IAAlB,CACA,MAAO,CACLC,KAASH,EAAKI,IAAd,KAAsBH,CADjB,CAELI,MAAOL,EAAKM,EAFP,CAIR,CANM,CAOR,CAED,GAAMC,GAAaX,EAAUY,KAAV,CAAgB,GAAhB,EAAqBC,MAArB,CAA4B,kBAA2B,EAAd,IAAb,CAA5B,CAAnB,CAEA,MAAO,MAAKf,UAAL,CACJI,KADI,GAEFY,IAFE,CAEG,SAACZ,CAAD,CAAW,CACf,GAAIa,GAASb,EAAMc,GAAnB,CAQA,MALED,EAKF,CAN0B,CAAtB,KAAWE,MAMf,CALWf,EAAMgB,UAAN,CAAiBC,gBAAjB,CAAkCJ,CAAlC,CAA0CJ,EAAW,CAAX,CAA1C,CAKX,CAHWT,EAAMgB,UAAN,CAAiBC,gBAAjB,CAAkCJ,CAAlC,CAA0CJ,EAAWS,IAAX,CAAgB,GAAhB,CAA1C,CAGX,CAAOnB,EAAkBc,CAAlB,CACR,CAZE,CAaR,C,yCAES,CACR,GAAMb,GAAQ,KAAKH,KAAL,CAAWsB,KAAX,CAAiB,oCAAjB,CAAd,CADQ,MAGJnB,EAHI,CAIC,KAAKA,KAAL,CAAWA,EAAM,CAAN,CAAX,CAJD,CAMDoB,QAAQC,OAAR,IACR,C,oEAKD1B,wB","file":"metricFindQuery.js","sourcesContent":["/**\r\n * @license\r\n * Copyright AdRem Software. All Rights Reserved.\r\n *\r\n * Use of this source code is governed by an Apache License, Version 2.0 that can be\r\n * found in the LICENSE file.\r\n */\r\n\r\nclass NetCrunchMetricFindQuery {\r\n\r\n  constructor(datasource, query) {\r\n    this.datasource = datasource;\r\n    this.query = query;\r\n  }\r\n\r\n  nodes(selectors) {\r\n\r\n    function createQueryResult(nodes) {\r\n      return nodes.map((node) => {\r\n        const ipAddress = (node.address != null) ? `(${node.address})` : '';\r\n        return {\r\n          text: `${node.name} ${ipAddress}`,\r\n          value: node.id\r\n        };\r\n      });\r\n    }\r\n\r\n    const parameters = selectors.split('.').filter(parameter => parameter !== '');\r\n\r\n    return this.datasource\r\n      .nodes()\r\n        .then((nodes) => {\r\n          let result = nodes.all;\r\n\r\n          if (parameters.length === 1) {\r\n            result = nodes.operations.deviceTypeFilter(result, parameters[0]);\r\n          } else {\r\n            result = nodes.operations.deviceTypeFilter(result, parameters.join('.'));\r\n          }\r\n\r\n          return createQueryResult(result);\r\n        });\r\n  }\r\n\r\n  process() {\r\n    const nodes = this.query.match(/^[nN][oO][dD][eE][sS]((\\.[\\w]+)*)$/);\r\n\r\n    if (nodes) {\r\n      return this.nodes(nodes[1]);\r\n    }\r\n    return Promise.resolve([]);\r\n  }\r\n\r\n}\r\n\r\nexport {\r\n  NetCrunchMetricFindQuery\r\n};\r\n"]}